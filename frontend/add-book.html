<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Добавить книгу</title>
    <link rel="stylesheet" href="css/styles.css">
</head>

<body>
    <nav id="navbar" class="navbar"></nav>
    <div class="container">
        <h1>Добавить новую книгу</h1>
        <form id="bookForm">
            <div class="form-group">
                <label for="bookTitle">Название книги</label>
                <input type="text" id="bookTitle" required>
            </div>
            <div class="form-group">
                <label for="bookAuthor">Автор</label>
                <input type="text" id="bookAuthor" required>
            </div>
            <div class="form-group">
                <label for="bookGenre">Жанр</label>
                <select id="bookGenre" required>
                    <option value="фантастика">Фантастика</option>
                    <option value="детектив">Детектив</option>
                    <option value="роман">Роман</option>
                    <option value="классика">Классика</option>
                </select>
            </div>
            <div class="form-group">
                <label for="bookYear">Год издания</label>
                <input type="number" id="bookYear" required>
            </div>
            <div class="form-group">
                <label for="bookCondition">Состояние</label>
                <select id="bookCondition" required>
                    <option value="новая">Новая</option>
                    <option value="хорошее">Хорошее</option>
                    <option value="удовлетворительное">Удовлетворительное</option>
                </select>
            </div>
            <div class="form-group">
                <label for="bookCity">Город</label>
                <input type="text" id="bookCity" required>
            </div>
            <div class="form-group">
                <label for="bookImage">URL обложки</label>
                <input type="text" id="bookImage" required>
            </div>
            <div class="form-group">
                <label for="bookContacts">Контакты для связи</label>
                <input type="text" id="bookContacts" placeholder="Например: email@example.com или @telegram">
            </div>
            <button type="submit">Добавить книгу</button>
            <button type="button" onclick="window.history.back()">Отменить</button>
        </form>
        <p id="error" class="error"></p>
    </div>
    <script src="js/api.js"></script>
    <script>
        function renderNavbar() {
            const token = localStorage.getItem('token');
            const isAdmin = localStorage.getItem('isAdmin') === 'true';
            const navbar = document.getElementById('navbar');
            navbar.innerHTML = `
                <a href="index.html">Главная</a>
                ${token ? `
                    <a href="profile.html">Профиль</a>
                    ${isAdmin ? '<a href="admin.html">Админ-панель</a>' : ''}
                    <button onclick="logout()">Выйти</button>
                ` : `
                    <a href="login.html">Войти</a>
                    <a href="register.html">Регистрация</a>
                `}
            `;
            if (!token) {
                window.location.href = 'login.html';
            }
        }
        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('userId');
            localStorage.removeItem('isAdmin');
            window.location.href = 'login.html';
        }
        document.getElementById('bookForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const token = localStorage.getItem('token');
            const data = {
                title: document.getElementById('bookTitle').value,
                author: document.getElementById('bookAuthor').value,
                genre: document.getElementById('bookGenre').value,
                year: parseInt(document.getElementById('bookYear').value),
                condition: document.getElementById('bookCondition').value,
                city: document.getElementById('bookCity').value,
                cover_image: document.getElementById('bookImage').value,
                contacts: document.getElementById('bookContacts').value || null
            };
            try {
                await createBook(data, token);
                alert('Книга успешно добавлена!');
                window.location.href = 'my-books.html';
            } catch (err) {
                document.getElementById('error').textContent = `Ошибка: ${err.message}`;
            }
        });
        window.onload = () => {
            renderNavbar();
        };
    </script>
</body>

</html>